<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–æ–º</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --secondary-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-color: #1f2937;
            --light-color: #f9fafb;
            --gray-color: #6b7280;
            --border-color: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --radius: 8px;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f3f4f6;
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* –®–∞–ø–∫–∞ */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo i {
            font-size: 2rem;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* –ú–µ–Ω—é */
        .nav-menu {
            display: flex;
            background: white;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
        }

        .nav-item {
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .nav-item:hover {
            background: #f3f4f6;
            color: var(--primary-color);
        }

        .nav-item.active {
            background: #eff6ff;
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--gray-color);
            font-size: 0.9rem;
        }

        /* –¢–∞–±–ª–∏—Ü—ã */
        .table-container {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .table-header {
            padding: 1.5rem;
            background: #f8fafc;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: #f1f5f9;
            font-weight: 600;
            color: var(--dark-color);
        }

        tr:hover {
            background: #f8fafc;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--dark-color);
        }

        .btn-outline:hover {
            background: #f8fafc;
            border-color: var(--primary-color);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: white;
            padding: 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 10000;
            animation: slideIn 0.3s ease;
            border-left: 4px solid;
        }

        .notification-success {
            border-left-color: var(--success-color);
        }

        .notification-error {
            border-left-color: var(--danger-color);
        }

        .notification-info {
            border-left-color: var(--primary-color);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* –§–æ—Ä–º—ã */
        .form-input {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 1rem;
            width: 100%;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
        }

        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: var(--radius);
            padding: 2rem;
            min-width: 500px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 1001;
            display: none;
            box-shadow: var(--shadow);
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
            gap: 1rem;
        }

        /* –û—Ç—á–µ—Ç—ã */
        .report-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .report-option {
            background: #f9fafb;
            padding: 1.5rem;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .report-option:hover {
            background: #f0f9ff;
            transform: translateY(-5px);
        }

        .export-options {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin: 1.5rem 0;
        }

        /* –°—Ç–∞—Ç—É—Å –±–∞–¥–∂–∏ */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-badge.success {
            background: #d1fae5;
            color: #065f46;
        }

        .status-badge.warning {
            background: #fef3c7;
            color: #92400e;
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */
        .progress-bar {
            height: 10px;
            background: #e5e7eb;
            border-radius: 5px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--success-color);
            transition: width 0.3s;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .modal {
                min-width: 90%;
                padding: 1rem;
            }
            
            .report-options {
                grid-template-columns: 1fr;
            }
            
            .export-options {
                flex-direction: column;
            }
        }

        .text-center {
            text-align: center;
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
        }

        .btn-group {
            display: flex;
            gap: 0.25rem;
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading" class="loading-overlay" style="display: none;">
        <i class="fas fa-spinner fa-spin fa-3x" style="color: var(--primary-color);"></i>
        <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-bus"></i>
                <div>
                    <h1>üöå SmartTransit</h1>
                    <div style="font-size: 0.9rem; opacity: 0.9;">–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–æ–º</div>
                </div>
            </div>
            <div class="user-menu">
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="currentUser">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                </div>
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                </button>
            </div>
        </header>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="nav-menu">
            <div class="nav-item active" data-section="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>–î–∞—à–±–æ—Ä–¥</span>
            </div>
            <div class="nav-item" data-section="buses">
                <i class="fas fa-bus"></i>
                <span>–ê–≤—Ç–æ–±—É—Å—ã</span>
            </div>
            <div class="nav-item" data-section="stops">
                <i class="fas fa-map-marker-alt"></i>
                <span>–û—Å—Ç–∞–Ω–æ–≤–∫–∏</span>
            </div>
            <div class="nav-item" data-section="passengers">
                <i class="fas fa-users"></i>
                <span>–ü–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫</span>
            </div>
            <div class="nav-item" data-section="reports">
                <i class="fas fa-file-alt"></i>
                <span>–û—Ç—á–µ—Ç—ã</span>
            </div>
        </nav>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="main-content">
            <div id="contentArea">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="modalOverlay" class="modal-overlay" onclick="closeModal()"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ—Ç—á–µ—Ç–∞ -->
    <div id="reportModal" class="modal">
        <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem;">
            <h3 style="margin: 0;">–ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á–µ—Ç–∞</h3>
            <button onclick="closeModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray-color);">&times;</button>
        </div>
        <div class="modal-body">
            <div id="reportContent" style="max-height: 400px; overflow-y: auto; padding: 1rem; background: #f8fafc; border-radius: var(--radius); font-family: monospace; white-space: pre-wrap;"></div>
        </div>
        <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; border-top: 1px solid var(--border-color); padding-top: 1rem;">
            <button class="btn btn-outline" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            <button class="btn btn-primary" id="downloadReportBtn">–°–∫–∞—á–∞—Ç—å</button>
        </div>
    </div>

    <script>
        // ================ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ================
        const API_BASE_URL = 'http://localhost:8080/api';
        let currentSection = 'dashboard';
        let currentReportId = null;

        // ================ –•–†–ê–ù–ò–õ–ò–©–ï –û–¢–ß–ï–¢–û–í ================
        class ReportStorage {
            constructor() {
                this.STORAGE_KEY = 'smarttransit_reports_v2';
                this.reports = this.loadReports();
            }
            
            loadReports() {
                try {
                    const stored = localStorage.getItem(this.STORAGE_KEY);
                    if (stored) {
                        const reports = JSON.parse(stored);
                        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –æ—Ç—á–µ—Ç–æ–≤
                        return reports.map(report => ({
                            ...report,
                            id: report.id || Date.now() + Math.random(),
                            createdAt: report.createdAt || new Date().toISOString(),
                            status: report.status || 'completed',
                            size: report.size || '1.2 KB'
                        }));
                    }
                    return [];
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç—á–µ—Ç–æ–≤:', error);
                    return [];
                }
            }
            
            saveReports() {
                try {
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(this.reports));
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤:', error);
                }
            }
            
            addReport(report) {
                const newReport = {
                    id: Date.now() + Math.random(),
                    createdAt: new Date().toISOString(),
                    status: 'completed',
                    size: '1.2 KB',
                    ...report
                };
                
                this.reports.unshift(newReport);
                this.saveReports();
                return newReport;
            }
            
            getReports() {
                return this.reports;
            }
            
            getReport(reportId) {
                return this.reports.find(r => r.id == reportId);
            }
            
            deleteReport(reportId) {
                this.reports = this.reports.filter(r => r.id != reportId);
                this.saveReports();
            }
            
            getStats() {
                const total = this.reports.length;
                const today = new Date().toDateString();
                const todayCount = this.reports.filter(r => 
                    new Date(r.createdAt).toDateString() === today
                ).length;
                
                return { total, today: todayCount };
            }
        }

        const reportStorage = new ReportStorage();

        // ================ –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ================
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function showLoading(show = true) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }

        function openModal(modalId) {
            document.getElementById('modalOverlay').style.display = 'block';
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal() {
            document.getElementById('modalOverlay').style.display = 'none';
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
        }

        // ================ API –§–£–ù–ö–¶–ò–ò ================
        async function fetchData(endpoint, options = {}) {
            try {
                showLoading(true);
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options,
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                if (response.status === 204) {
                    return null;
                }
                
                const contentType = response.headers.get('content-type');
                if (contentType && contentType.includes('application/json')) {
                    return await response.json();
                }
                
                return await response.text();
            } catch (error) {
                console.error('API Error:', error);
                showNotification(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                return null;
            } finally {
                showLoading(false);
            }
        }

        // ================ –ó–ê–ì–†–£–ó–ö–ê –°–ï–ö–¶–ò–ô ================
        function loadSection(section) {
            currentSection = section;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.section === section) {
                    item.classList.add('active');
                }
            });

            switch(section) {
                case 'dashboard': loadDashboard(); break;
                case 'buses': loadBuses(); break;
                case 'stops': loadStops(); break;
                case 'passengers': loadPassengers(); break;
                case 'reports': loadReports(); break;
            }
        }

        // ================ –î–ê–®–ë–û–†–î ================
        async function loadDashboard() {
            const html = `
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">–ê–≤—Ç–æ–±—É—Å—ã</h3>
                            <div style="width: 48px; height: 48px; border-radius: 50%; background: #dbeafe; color: var(--primary-color); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                                <i class="fas fa-bus"></i>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="stat-number" id="buses-count">0</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –∞–≤—Ç–æ–±—É—Å–æ–≤</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">–û—Å—Ç–∞–Ω–æ–≤–∫–∏</h3>
                            <div style="width: 48px; height: 48px; border-radius: 50%; background: #dcfce7; color: var(--success-color); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="stat-number" id="stops-count">0</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">–ü–∞—Å—Å–∞–∂–∏—Ä—ã</h3>
                            <div style="width: 48px; height: 48px; border-radius: 50%; background: #fef3c7; color: var(--warning-color); display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="stat-number" id="passengers-count">0</div>
                            <div class="stat-label">–ó–∞–ø–∏—Å–µ–π –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–∞</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">–û—Ç—á–µ—Ç—ã</h3>
                            <div style="width: 48px; height: 48px; border-radius: 50%; background: #fce7f3; color: #db2777; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                                <i class="fas fa-file-alt"></i>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="stat-number" id="reports-count">0</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –æ—Ç—á–µ—Ç–æ–≤</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: white; border-radius: var(--radius); padding: 1.5rem; margin-top: 2rem; box-shadow: var(--shadow);">
                    <h3 style="margin-bottom: 1rem;">–ì—Ä–∞—Ñ–∏–∫ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–∞</h3>
                    <canvas id="trafficChart" height="100"></canvas>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = html;
            updateDashboardStats();
            initTrafficChart();
        }

        async function updateDashboardStats() {
            try {
                const [buses, stops, passengers] = await Promise.all([
                    fetchData('/buses'),
                    fetchData('/stops'),
                    fetchData('/passengers')
                ]);

                const stats = reportStorage.getStats();
                
                document.getElementById('buses-count').textContent = buses?.length || 0;
                document.getElementById('stops-count').textContent = stops?.length || 0;
                document.getElementById('passengers-count').textContent = passengers?.length || 0;
                document.getElementById('reports-count').textContent = stats.total;
            } catch (error) {
                console.error('Error updating dashboard:', error);
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                document.getElementById('buses-count').textContent = '12';
                document.getElementById('stops-count').textContent = '45';
                document.getElementById('passengers-count').textContent = '1567';
                document.getElementById('reports-count').textContent = reportStorage.getStats().total;
            }
        }

        function initTrafficChart() {
            const ctx = document.getElementById('trafficChart')?.getContext('2d');
            if (!ctx) return;
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['6:00', '8:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00'],
                    datasets: [{
                        label: '–ü–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫',
                        data: [65, 80, 75, 90, 85, 95, 88, 70],
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '–°—Ä–µ–¥–Ω–∏–π –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫ –ø–æ —á–∞—Å–∞–º'
                        }
                    }
                }
            });
        }

        // ================ –û–¢–ß–ï–¢–´ ================
        async function loadReports() {
            const html = `
                <div class="table-container">
                    <div class="table-header">
                        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞–º–∏</h3>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-success" onclick="generateReport('daily')">
                                <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç
                            </button>
                            <button class="btn btn-outline" onclick="refreshReports()">
                                <i class="fas fa-sync"></i> –û–±–Ω–æ–≤–∏—Ç—å
                            </button>
                        </div>
                    </div>
                    
                    <div style="padding: 1.5rem;">
                        <h4 style="margin-bottom: 1rem;">–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ—Ç—á–µ—Ç—ã</h4>
                        <div class="report-options">
                            <div class="report-option" onclick="generateReport('daily')">
                                <i class="fas fa-calendar-day" style="font-size: 2rem; color: var(--primary-color); margin-bottom: 0.5rem;"></i>
                                <h4>–°—É—Ç–æ—á–Ω—ã–π –æ—Ç—á–µ—Ç</h4>
                                <p>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å</p>
                            </div>
                            <div class="report-option" onclick="generateReport('weekly')">
                                <i class="fas fa-calendar-week" style="font-size: 2rem; color: var(--success-color); margin-bottom: 0.5rem;"></i>
                                <h4>–ù–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç</h4>
                                <p>–ê–Ω–∞–ª–∏–∑ –∑–∞ –Ω–µ–¥–µ–ª—é</p>
                            </div>
                            <div class="report-option" onclick="generateReport('monthly')">
                                <i class="fas fa-calendar-alt" style="font-size: 2rem; color: var(--warning-color); margin-bottom: 0.5rem;"></i>
                                <h4>–ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç</h4>
                                <p>–û—Ç—á–µ—Ç –∑–∞ –º–µ—Å—è—Ü</p>
                            </div>
                            <div class="report-option" onclick="generateReport('route')">
                                <i class="fas fa-route" style="font-size: 2rem; color: #db2777; margin-bottom: 0.5rem;"></i>
                                <h4>–û—Ç—á–µ—Ç –ø–æ –º–∞—Ä—à—Ä—É—Ç—É</h4>
                                <p>–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –º–∞—Ä—à—Ä—É—Ç–∞</p>
                            </div>
                        </div>
                        
                        <h4 style="margin-top: 2rem; margin-bottom: 1rem;">–ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á–µ—Ç–æ–≤</h4>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>–î–∞—Ç–∞</th>
                                        <th>–¢–∏–ø –æ—Ç—á–µ—Ç–∞</th>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>–†–∞–∑–º–µ—Ä</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="reportsHistory">
                                    <tr>
                                        <td colspan="6" class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="export-options" style="margin-top: 2rem;">
                            <h4 style="margin-bottom: 1rem;">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h4>
                            <button class="btn btn-outline" onclick="exportData('csv')">
                                <i class="fas fa-file-csv"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
                            </button>
                            <button class="btn btn-outline" onclick="exportData('excel')">
                                <i class="fas fa-file-excel"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
                            </button>
                            <button class="btn btn-outline" onclick="exportData('json')">
                                <i class="fas fa-code"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = html;
            loadReportsHistory();
        }

        async function loadReportsHistory() {
            const reports = reportStorage.getReports();
            const tbody = document.getElementById('reportsHistory');
            
            if (!tbody) return;
            
            if (reports.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center" style="padding: 2rem;">
                            <i class="fas fa-file-alt" style="font-size: 2rem; color: var(--gray-color); margin-bottom: 1rem; display: block;"></i>
                            <p>–ù–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤</p>
                            <button class="btn btn-outline btn-sm" onclick="generateReport('daily')" style="margin-top: 1rem;">
                                <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—ã–π –æ—Ç—á–µ—Ç
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = reports.map(report => `
                <tr>
                    <td>${new Date(report.createdAt).toLocaleDateString()}<br>
                        <small style="color: var(--gray-color);">${new Date(report.createdAt).toLocaleTimeString()}</small>
                    </td>
                    <td>
                        <strong>${getReportName(report.type)}</strong><br>
                        <small style="color: var(--gray-color);">${report.type}</small>
                    </td>
                    <td>${report.name || getReportName(report.type)}</td>
                    <td>${report.size || '1.2 KB'}</td>
                    <td>
                        <span class="status-badge ${report.status === 'completed' ? 'success' : 'warning'}">
                            ${report.status === 'completed' ? '–ó–∞–≤–µ—Ä—à–µ–Ω' : '–í –ø—Ä–æ—Ü–µ—Å—Å–µ'}
                        </span>
                    </td>
                    <td>
                        <div class="btn-group">
                            <button class="btn btn-outline btn-sm" onclick="viewReport(${report.id})" title="–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="downloadReport(${report.id})" title="–°–∫–∞—á–∞—Ç—å">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn btn-outline btn-sm" onclick="deleteReport(${report.id})" title="–£–¥–∞–ª–∏—Ç—å">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // ================ –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –û–¢–ß–ï–¢–ê–ú–ò ================
        function getReportName(type) {
            const names = {
                daily: '–°—É—Ç–æ—á–Ω—ã–π –æ—Ç—á–µ—Ç',
                weekly: '–ù–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç',
                monthly: '–ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á–µ—Ç',
                route: '–û—Ç—á–µ—Ç –ø–æ –º–∞—Ä—à—Ä—É—Ç—É'
            };
            return names[type] || '–û—Ç—á–µ—Ç';
        }

        async function generateReport(type) {
            try {
                showNotification(`üöÄ –ù–∞—á–∏–Ω–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –æ—Ç—á–µ—Ç–∞ "${getReportName(type)}"...`, 'info');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                showProgress(10, `–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á–µ—Ç–∞...`);
                
                // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                const reportData = await collectReportData(type);
                
                showProgress(50, `–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞...`);
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
                const reportContent = generateReportContent(type, reportData);
                
                showProgress(80, `–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞...`);
                
                // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –æ—Ç—á–µ—Ç–∞
                const report = {
                    type: type,
                    name: getReportName(type),
                    content: reportContent,
                    format: 'txt',
                    parameters: {
                        date: new Date().toLocaleDateString(),
                        time: new Date().toLocaleTimeString()
                    }
                };
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤ –ø–æ –º–∞—Ä—à—Ä—É—Ç—É
                if (type === 'route') {
                    const routeNumber = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –º–∞—Ä—à—Ä—É—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:', '7A');
                    if (routeNumber) {
                        report.parameters.route = routeNumber;
                        report.name = `–û—Ç—á–µ—Ç –ø–æ –º–∞—Ä—à—Ä—É—Ç—É ${routeNumber}`;
                    }
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç—á–µ—Ç
                const savedReport = reportStorage.addReport(report);
                
                showProgress(100, `–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!`);
                
                // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
                const filename = `${report.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.txt`;
                downloadFile(reportContent, filename, 'text/plain');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Å—Ç–æ—Ä–∏—é
                await loadReportsHistory();
                
                showNotification(`‚úÖ –û—Ç—á–µ—Ç "${report.name}" —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–∫–∞—á–∞–Ω`, 'success');
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ —Å–∫—Ä—ã—Ç–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                setTimeout(() => hideProgress(), 1000);
                
                return savedReport;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞:', error);
                showNotification(`‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç—á–µ—Ç–∞: ${error.message}`, 'error');
                hideProgress();
                return null;
            }
        }

        function showProgress(percent, message = '') {
            // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
            let progressBar = document.getElementById('progressBar');
            if (!progressBar) {
                progressBar = document.createElement('div');
                progressBar.id = 'progressBar';
                progressBar.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 4px;
                    background: #e5e7eb;
                    z-index: 10001;
                `;
                
                const progressFill = document.createElement('div');
                progressFill.id = 'progressFill';
                progressFill.style.cssText = `
                    height: 100%;
                    background: var(--success-color);
                    width: ${percent}%;
                    transition: width 0.3s;
                `;
                
                progressBar.appendChild(progressFill);
                document.body.appendChild(progressBar);
            } else {
                document.getElementById('progressFill').style.width = `${percent}%`;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (message) {
                let messageDiv = document.getElementById('progressMessage');
                if (!messageDiv) {
                    messageDiv = document.createElement('div');
                    messageDiv.id = 'progressMessage';
                    messageDiv.style.cssText = `
                        position: fixed;
                        top: 10px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: white;
                        padding: 0.5rem 1rem;
                        border-radius: var(--radius);
                        box-shadow: var(--shadow);
                        z-index: 10002;
                        font-size: 0.9rem;
                    `;
                    document.body.appendChild(messageDiv);
                }
                messageDiv.textContent = message;
                messageDiv.style.display = 'block';
            }
        }

        function hideProgress() {
            const progressBar = document.getElementById('progressBar');
            if (progressBar) progressBar.remove();
            
            const messageDiv = document.getElementById('progressMessage');
            if (messageDiv) messageDiv.style.display = 'none';
        }

        async function collectReportData(type) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥—É—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ API
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            return {
                type: type,
                date: new Date().toLocaleDateString(),
                time: new Date().toLocaleTimeString(),
                statistics: {
                    totalPassengers: Math.floor(Math.random() * 10000) + 5000,
                    totalBuses: Math.floor(Math.random() * 50) + 20,
                    totalStops: Math.floor(Math.random() * 100) + 50,
                    avgLoad: Math.floor(Math.random() * 100),
                    peakHour: `${Math.floor(Math.random() * 12) + 6}:00`
                }
            };
        }

        function generateReportContent(type, data) {
            const now = new Date();
            const reportDate = now.toLocaleDateString();
            const reportTime = now.toLocaleTimeString();
            
            switch(type) {
                case 'daily':
                    return generateDailyReport(data, reportDate, reportTime);
                case 'weekly':
                    return generateWeeklyReport(data, reportDate, reportTime);
                case 'monthly':
                    return generateMonthlyReport(data, reportDate, reportTime);
                case 'route':
                    return generateRouteReport(data, reportDate, reportTime);
                default:
                    return generateGeneralReport(data, reportDate, reportTime);
            }
        }

        function generateDailyReport(data, date, time) {
            return `
====================================================================
                  –°–£–¢–û–ß–ù–´–ô –û–¢–ß–ï–¢ –ü–û –ü–ê–°–°–ê–ñ–ò–†–û–ü–û–¢–û–ö–£
====================================================================

–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: ${date} ${time}

=======================================================
                    –û–°–ù–û–í–ù–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò
=======================================================

üìä –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:
‚îú‚îÄ –í—Å–µ–≥–æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ –∑–∞ –¥–µ–Ω—å: ${data.statistics.totalPassengers.toLocaleString()} —á–µ–ª.
‚îú‚îÄ –°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ —á–∞—Å: ${Math.round(data.statistics.totalPassengers / 24).toLocaleString()} —á–µ–ª./—á–∞—Å
‚îú‚îÄ –ü–∏–∫–æ–≤—ã–π —á–∞—Å: ${data.statistics.peakHour}
‚îú‚îÄ –°–∞–º—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è, –í–æ–∫–∑–∞–ª—å–Ω–∞—è, –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç

üöå –ü–ê–†–ö –ê–í–¢–û–ë–£–°–û–í:
‚îú‚îÄ –í—Å–µ–≥–æ –∞–≤—Ç–æ–±—É—Å–æ–≤: ${data.statistics.totalBuses}
‚îú‚îÄ –í —Ä–∞–±–æ—Ç–µ: ${Math.floor(data.statistics.totalBuses * 0.85)}
‚îî‚îÄ –ü—Ä–æ—Å—Ç–æ–π: ${Math.floor(data.statistics.totalBuses * 0.15)}

üìç –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ê:
‚îú‚îÄ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫: ${data.statistics.totalStops}
‚îú‚îÄ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ä—à—Ä—É—Ç–æ–≤: 24
‚îî‚îÄ –û–±—â–∞—è –ø—Ä–æ—Ç—è–∂–µ–Ω–Ω–æ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç–æ–≤: 187 –∫–º

=======================================================
                    –†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–û –ß–ê–°–ê–ú
=======================================================

 06:00 ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà            ‚îÇ  650 —á–µ–ª.
 08:00 ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    ‚îÇ 1200 —á–µ–ª.
 10:00 ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà      ‚îÇ 1100 —á–µ–ª.
 12:00 ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  ‚îÇ 1300 —á–µ–ª.
 14:00 ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    ‚îÇ 1200 —á–µ–ª.
 16:00 ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚îÇ 1400 —á–µ–ª.
 18:00 ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   ‚îÇ 1350 —á–µ–ª.
 20:00 ‚îÇ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà            ‚îÇ  700 —á–µ–ª.

=======================================================
               –¢–û–ü-5 –°–ê–ú–´–• –ó–ê–ì–†–£–ñ–ï–ù–ù–´–• –û–°–¢–ê–ù–û–í–û–ö
=======================================================

  ü•á –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å - 1,850 –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤
  ü•à –ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π –≤–æ–∫–∑–∞–ª - 1,720 –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤
  ü•â –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç - 1,540 –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤
  4. –¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä - 1,320 –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤
  5. –°—Ç–∞–¥–∏–æ–Ω - 1,150 –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤

=======================================================
                    –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò
=======================================================

‚Ä¢ –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≤—Ç–æ–±—É—Å–æ–≤ –Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∞—Ö 7A –∏ 12B
‚Ä¢ –í–≤–µ—Å—Ç–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–π—Å—ã –≤ —á–∞—Å—ã –ø–∏–∫ (8:00 –∏ 18:00)
‚Ä¢ –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è"
‚Ä¢ –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ 3 –∞–≤—Ç–æ–±—É—Å–æ–≤

=======================================================
–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π SmartTransit
–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å: support@smarttransit.ru
====================================================================
`;
        }

        function generateWeeklyReport(data, date, time) {
            return `
====================================================================
                   –ù–ï–î–ï–õ–¨–ù–´–ô –û–¢–ß–ï–¢
====================================================================

–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: ${date} ${time}
–ü–µ—Ä–∏–æ–¥: —Å ${new Date(Date.now() - 6 * 86400000).toLocaleDateString()} 
–ø–æ ${new Date().toLocaleDateString()}

=======================================================
                    –ö–õ–Æ–ß–ï–í–´–ï –ú–ï–¢–†–ò–ö–ò
=======================================================

üìä –ü–ê–°–°–ê–ñ–ò–†–û–ü–û–¢–û–ö –ó–ê –ù–ï–î–ï–õ–Æ:
‚îú‚îÄ –í—Å–µ–≥–æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤: ${(data.statistics.totalPassengers * 7).toLocaleString()} —á–µ–ª.
‚îú‚îÄ –°—Ä–µ–¥–Ω–µ–¥–Ω–µ–≤–Ω–æ–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å: ${data.statistics.totalPassengers.toLocaleString()} —á–µ–ª./–¥–µ–Ω—å
‚îú‚îÄ –ü–∏–∫–æ–≤–∞—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å: ${data.statistics.peakHour}
‚îî‚îÄ –î–∏–Ω–∞–º–∏–∫–∞ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–∞: –†–æ—Å—Ç –Ω–∞ 5% –∫ –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ

üöå –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–¨ –¢–†–ê–ù–°–ü–û–†–¢–ê:
‚îú‚îÄ –°—Ä–µ–¥–Ω—è—è –∑–∞–≥—Ä—É–∑–∫–∞ –∞–≤—Ç–æ–±—É—Å–æ–≤: ${data.statistics.avgLoad}%
‚îú‚îÄ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: 87%
‚îî‚îÄ –ü—Ä–æ–±–µ–≥ –∞–≤—Ç–æ–±—É—Å–æ–≤: 15,680 –∫–º

üí∞ –≠–ö–û–ù–û–ú–ò–ß–ï–°–ö–ò–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò:
‚îú‚îÄ –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞: ${(data.statistics.totalPassengers * 50 * 7).toLocaleString()} —Ä—É–±.
‚îú‚îÄ –°—Ä–µ–¥–Ω—è—è –≤—ã—Ä—É—á–∫–∞ –Ω–∞ –∞–≤—Ç–æ–±—É—Å: ${Math.round(data.statistics.totalPassengers * 50 * 7 / data.statistics.totalBuses).toLocaleString()} —Ä—É–±.
‚îî‚îÄ –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–∑–∫–∏: 28 —Ä—É–±./–ø–∞—Å—Å.

=======================================================
               –ê–ù–ê–õ–ò–ó –ü–û –î–ù–Ø–ú –ù–ï–î–ï–õ–ò
=======================================================

  –ü–Ω ‚îÇ 12,450 –ø–∞—Å—Å. ‚îÇ 622,500 —Ä—É–±. ‚îÇ 78% –∑–∞–≥—Ä—É–∑–∫–∞
  –í—Ç ‚îÇ 13,200 –ø–∞—Å—Å. ‚îÇ 660,000 —Ä—É–±. ‚îÇ 82% –∑–∞–≥—Ä—É–∑–∫–∞
  –°—Ä ‚îÇ 11,850 –ø–∞—Å—Å. ‚îÇ 592,500 —Ä—É–±. ‚îÇ 75% –∑–∞–≥—Ä—É–∑–∫–∞
  –ß—Ç ‚îÇ 12,800 –ø–∞—Å—Å. ‚îÇ 640,000 —Ä—É–±. ‚îÇ 80% –∑–∞–≥—Ä—É–∑–∫–∞
  –ü—Ç ‚îÇ 14,250 –ø–∞—Å—Å. ‚îÇ 712,500 —Ä—É–±. ‚îÇ 88% –∑–∞–≥—Ä—É–∑–∫–∞
  –°–± ‚îÇ 10,500 –ø–∞—Å—Å. ‚îÇ 525,000 —Ä—É–±. ‚îÇ 65% –∑–∞–≥—Ä—É–∑–∫–∞
  –í—Å ‚îÇ  8,750 –ø–∞—Å—Å. ‚îÇ 437,500 —Ä—É–±. ‚îÇ 55% –∑–∞–≥—Ä—É–∑–∫–∞

=======================================================
                –¢–û–ü-3 –ú–ê–†–®–†–£–¢–ê –ü–û –ó–ê–ì–†–£–ñ–ï–ù–ù–û–°–¢–ò
=======================================================

  1. –ú–∞—Ä—à—Ä—É—Ç 7A    ‚îÇ 15,240 –ø–∞—Å—Å. ‚îÇ 85% –∑–∞–≥—Ä—É–∑–∫–∞ ‚îÇ 7,5 –∫–º
  2. –ú–∞—Ä—à—Ä—É—Ç 12B   ‚îÇ 12,850 –ø–∞—Å—Å. ‚îÇ 78% –∑–∞–≥—Ä—É–∑–∫–∞ ‚îÇ 9,2 –∫–º  
  3. –ú–∞—Ä—à—Ä—É—Ç 25C   ‚îÇ 10,560 –ø–∞—Å—Å. ‚îÇ 72% –∑–∞–≥—Ä—É–∑–∫–∞ ‚îÇ 6,8 –∫–º

=======================================================
                    –í–´–í–û–î–´ –ò –ü–õ–ê–ù–´
=======================================================

  1. –ü–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫ —Å—Ç–∞–±–∏–ª–µ–Ω, –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è —Ä–æ—Å—Ç –Ω–∞ 5%
  2. –ú–∞—Ä—à—Ä—É—Ç 7A —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ–π—Å–æ–≤
  3. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è" —Ç—Ä–µ–±—É–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
  4. –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ 5 –∞–≤—Ç–æ–±—É—Å–æ–≤

====================================================================
–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–æ–º SmartTransit v1.0
¬© 2024 –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã
====================================================================
`;
        }

        function generateMonthlyReport(data, date, time) {
            return `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    –ú–ï–°–Ø–ß–ù–´–ô –û–¢–ß–ï–¢                               ‚ïë
‚ïë                    SMARTTRANSIT SYSTEM                          ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ
  üìÖ –û—Ç—á–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥: ${new Date().toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' })}
  üïê –î–∞—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${date} ${time}
  üìä –¢–∏–ø –æ—Ç—á–µ—Ç–∞: –ú–µ—Å—è—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑
‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      –°–í–û–î–ù–´–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  üìà –ü–ê–°–°–ê–ñ–ò–†–û–ü–û–¢–û–ö:                                              ‚îÇ
‚îÇ    ‚Ä¢ –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${(data.statistics.totalPassengers * 30).toLocaleString().padEnd(12)} —á–µ–ª.‚îÇ
‚îÇ    ‚Ä¢ –°—Ä–µ–¥–Ω–µ–¥–Ω–µ–≤–Ω–æ–π: ${data.statistics.totalPassengers.toLocaleString().padEnd(13)} —á–µ–ª./–¥–µ–Ω—å‚îÇ
‚îÇ    ‚Ä¢ –ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: ${data.statistics.peakHour}               ‚îÇ
‚îÇ    ‚Ä¢ –¢–µ–Ω–¥–µ–Ω—Ü–∏—è: –°—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç                                  ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  üöå –†–ï–°–£–†–°–´:                                                     ‚îÇ
‚îÇ    ‚Ä¢ –ê–≤—Ç–æ–±—É—Å—ã –≤—Å–µ–≥–æ: ${data.statistics.totalBuses.toString().padEnd(18)} –µ–¥.‚îÇ
‚îÇ    ‚Ä¢ –ê–≤—Ç–æ–±—É—Å—ã –∞–∫—Ç–∏–≤–Ω—ã–µ: ${Math.floor(data.statistics.totalBuses * 0.85).toString().padEnd(13)} –µ–¥.‚îÇ
‚îÇ    ‚Ä¢ –û—Å—Ç–∞–Ω–æ–≤–∫–∏: ${data.statistics.totalStops.toString().padEnd(21)} –µ–¥.‚îÇ
‚îÇ    ‚Ä¢ –ú–∞—Ä—à—Ä—É—Ç—ã: 24                                                ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  üí∞ –§–ò–ù–ê–ù–°–´:                                                     ‚îÇ
‚îÇ    ‚Ä¢ –í—ã—Ä—É—á–∫–∞: ${(data.statistics.totalPassengers * 50 * 30).toLocaleString().padEnd(17)} —Ä—É–±.‚îÇ
‚îÇ    ‚Ä¢ –†–∞—Å—Ö–æ–¥—ã: ${(data.statistics.totalPassengers * 28 * 30).toLocaleString().padEnd(18)} —Ä—É–±.‚îÇ
‚îÇ    ‚Ä¢ –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å: 22%                                         ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               –ê–ù–ê–õ–ò–ó –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–ò –ü–û –ù–ï–î–ï–õ–Ø–ú                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îÇ  –ù–µ–¥–µ–ª—è 1 ‚îÇ 85,240 –ø–∞—Å—Å. ‚îÇ 4,262,000 —Ä—É–±. ‚îÇ 82% —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å  ‚îÇ
‚îÇ  ‚îÇ  –ù–µ–¥–µ–ª—è 2 ‚îÇ 87,850 –ø–∞—Å—Å. ‚îÇ 4,392,500 —Ä—É–±. ‚îÇ 84% —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å  ‚îÇ
‚îÇ  ‚îÇ  –ù–µ–¥–µ–ª—è 3 ‚îÇ 90,560 –ø–∞—Å—Å. ‚îÇ 4,528,000 —Ä—É–±. ‚îÇ 86% —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å  ‚îÇ
‚îÇ  ‚îÇ  –ù–µ–¥–µ–ª—è 4 ‚îÇ 92,150 –ø–∞—Å—Å. ‚îÇ 4,607,500 —Ä—É–±. ‚îÇ 88% —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å  ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               –ü–†–û–ë–õ–ï–ú–ù–´–ï –ó–û–ù–´ –ò –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  üî¥ –ü–†–û–ë–õ–ï–ú–´:                                                    ‚îÇ
‚îÇ    ‚Ä¢ –ú–∞—Ä—à—Ä—É—Ç 7A: –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –≤ —á–∞—Å—ã –ø–∏–∫ (–¥–æ 120%)                ‚îÇ
‚îÇ    ‚Ä¢ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ "–¶–µ–Ω—Ç—Ä": –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å               ‚îÇ
‚îÇ    ‚Ä¢ 3 –∞–≤—Ç–æ–±—É—Å–∞ —Ç—Ä–µ–±—É—é—Ç —Å—Ä–æ—á–Ω–æ–≥–æ —Ä–µ–º–æ–Ω—Ç–∞                        ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  üü¢ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:                                               ‚îÇ
‚îÇ    ‚Ä¢ –í–≤–µ—Å—Ç–∏ 2 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∞–≤—Ç–æ–±—É—Å–∞ –Ω–∞ –º–∞—Ä—à—Ä—É—Ç 7A             ‚îÇ
‚îÇ    ‚Ä¢ –†–∞—Å—à–∏—Ä–∏—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫—É "–¶–µ–Ω—Ç—Ä"                                ‚îÇ
‚îÇ    ‚Ä¢ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Ö–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é          ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        –ü–õ–ê–ù –ù–ê –°–õ–ï–î–£–Æ–©–ò–ô –ú–ï–°–Ø–¶                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  üéØ –¶–ï–õ–ò:                                                       ‚îÇ
‚îÇ    ‚Ä¢ –£–≤–µ–ª–∏—á–∏—Ç—å –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫ –Ω–∞ 10%                            ‚îÇ
‚îÇ    ‚Ä¢ –°–Ω–∏–∑–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–π –∞–≤—Ç–æ–±—É—Å–æ–≤ –¥–æ 5%                            ‚îÇ
‚îÇ    ‚Ä¢ –ü–æ–≤—ã—Å–∏—Ç—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ –¥–æ 90%               ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  üìÖ –ú–ï–†–û–ü–†–ò–Ø–¢–ò–Ø:                                                ‚îÇ
‚îÇ    ‚Ä¢ 01-07: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤                               ‚îÇ
‚îÇ    ‚Ä¢ 08-14: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ                            ‚îÇ
‚îÇ    ‚Ä¢ 15-21: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏           ‚îÇ
‚îÇ    ‚Ä¢ 22-30: –ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏               ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  –°–∏—Å—Ç–µ–º–∞: SmartTransit Passenger Flow Management System v1.0
  –ö–æ–Ω—Ç–∞–∫—Ç: analytics@smarttransit.ru | +7 (495) 123-45-67
  –ê–Ω–∞–ª–∏—Ç–∏–∫: –ò–≤–∞–Ω–æ–≤ –ê.–ü.
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
`;
        }

        function generateRouteReport(data, date, time) {
            const routeNumber = data.parameters?.route || '7A';
            
            return `
>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
                –û–¢–ß–ï–¢ –ü–û –ú–ê–†–®–†–£–¢–£ ‚Ññ${routeNumber}
                –ê–ù–ê–õ–ò–ó –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–ò –ò –ó–ê–ì–†–£–ñ–ï–ù–ù–û–°–¢–ò
>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

üìÖ –î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞: ${date}
üïê –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${time}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                        –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ò –ú–ê–†–®–†–£–¢–ê
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

‚Ä¢ –ù–æ–º–µ—Ä –º–∞—Ä—à—Ä—É—Ç–∞: ${routeNumber}
‚Ä¢ –¢–∏–ø –º–∞—Ä—à—Ä—É—Ç–∞: –ì–æ—Ä–æ–¥—Å–∫–æ–π
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫: 18
‚Ä¢ –ü—Ä–æ—Ç—è–∂–µ–Ω–Ω–æ—Å—Ç—å: 7.5 –∫–º
‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è —Ä–µ–π—Å–∞: 45 –º–∏–Ω.
‚Ä¢ –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–≤–∏–∂–µ–Ω–∏—è: 10-15 –º–∏–Ω.

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                    –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–ê–°–°–ê–ñ–ò–†–û–ü–û–¢–û–ö–ê
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

üìä –û–ë–©–ò–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò:
  ‚îú‚îÄ –°—Ä–µ–¥–Ω–µ—Å—É—Ç–æ—á–Ω—ã–π –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫: 1,524 —á–µ–ª.
  ‚îú‚îÄ –ó–∞–≥—Ä—É–∑–∫–∞ –≤ —á–∞—Å –ø–∏–∫: 85%
  ‚îú‚îÄ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è: 78%
  ‚îî‚îÄ –í—ã—Ä—É—á–∫–∞ –∑–∞ –¥–µ–Ω—å: 76,200 —Ä—É–±.

üïí –†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–û –ß–ê–°–ê–ú:
  06:00-07:00: 120 —á–µ–ª. (‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë)
  08:00-09:00: 450 —á–µ–ª. (‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë)
  10:00-11:00: 280 —á–µ–ª. (‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë)
  12:00-13:00: 320 —á–µ–ª. (‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë)
  14:00-15:00: 250 —á–µ–ª. (‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë)
  16:00-17:00: 380 —á–µ–ª. (‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë)
  18:00-19:00: 420 —á–µ–ª. (‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë)
  20:00-21:00: 180 —á–µ–ª. (‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë)

üìç –ó–ê–ì–†–£–ñ–ï–ù–ù–û–°–¢–¨ –û–°–¢–ê–ù–û–í–û–ö:
  1. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å: 185 —á–µ–ª./—á–∞—Å
  2. –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç: 162 —á–µ–ª./—á–∞—Å
  3. –ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π –≤–æ–∫–∑–∞–ª: 148 —á–µ–ª./—á–∞—Å
  4. –¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä: 135 —á–µ–ª./—á–∞—Å
  5. –°—Ç–∞–¥–∏–æ–Ω: 112 —á–µ–ª./—á–∞—Å

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                        –ê–ù–ê–õ–ò–ó –≠–§–§–ï–ö–¢–ò–í–ù–û–°–¢–ò
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

‚úÖ –°–ò–õ–¨–ù–´–ï –°–¢–û–†–û–ù–´:
  ‚Ä¢ –í—ã—Å–æ–∫–∏–π –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫ –≤ —á–∞—Å—ã –ø–∏–∫
  ‚Ä¢ –°—Ç–∞–±–∏–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–≤–∏–∂–µ–Ω–∏—è
  ‚Ä¢ –•–æ—Ä–æ—à–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∂–∏–ª—ã—Ö —Ä–∞–π–æ–Ω–æ–≤

‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ù–´–ï –ú–û–ú–ï–ù–¢–´:
  ‚Ä¢ –ü–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã—Ö –æ—Å—Ç–∞–Ω–æ–≤–∫–∞—Ö
  ‚Ä¢ –î–ª–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –≤ –≤–µ—á–µ—Ä–Ω–∏–µ —á–∞—Å—ã
  ‚Ä¢ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –∞–≤—Ç–æ–±—É—Å–æ–≤

üìà –ü–û–¢–ï–ù–¶–ò–ê–õ –£–õ–£–ß–®–ï–ù–ò–ô:
  ‚Ä¢ –í–≤–µ–¥–µ–Ω–∏–µ —ç–∫—Å–ø—Ä–µ—Å—Å-—Ä–µ–π—Å–æ–≤
  ‚Ä¢ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –¥–≤–∏–∂–µ–Ω–∏—è –≤ —á–∞—Å—ã –ø–∏–∫
  ‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–±—É—Å–æ–≤ –±–æ–ª—å—à–µ–π –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
                        –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

1. –í–≤–µ—Å—Ç–∏ 2 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∞–≤—Ç–æ–±—É—Å–∞ –Ω–∞ –º–∞—Ä—à—Ä—É—Ç –≤ —á–∞—Å—ã –ø–∏–∫
2. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ —ç–∫—Å–ø—Ä–µ—Å—Å-–≤–∞—Ä–∏–∞–Ω—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞
3. –£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–≤–∏–∂–µ–Ω–∏—è –≤ –≤–µ—á–µ—Ä–Ω–µ–µ –≤—Ä–µ–º—è –¥–æ 20 –º–∏–Ω—É—Ç
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–µ –ø–∞–≤–∏–ª—å–æ–Ω—ã

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  –û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –æ—Ç–¥–µ–ª–æ–º –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ SmartTransit
  –°–ª–µ–¥—É—é—â–∏–π –∞–Ω–∞–ª–∏–∑: ${new Date(Date.now() + 30 * 86400000).toLocaleDateString()}
  –ö–æ–Ω—Ç–∞–∫—Ç –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º: routes@smarttransit.ru
>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
`;
        }

        function generateGeneralReport(data, date, time) {
            return `
====================================================================
                         –û–ë–©–ò–ô –û–¢–ß–ï–¢
====================================================================

–û—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: ${date} ${time}

–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
‚Ä¢ –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤: ${data.statistics.totalPassengers}
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–≤—Ç–æ–±—É—Å–æ–≤: ${data.statistics.totalBuses}
‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å—Ç–∞–Ω–æ–≤–æ–∫: ${data.statistics.totalStops}

–î–∞–Ω–Ω—ã–µ —Å–æ–±—Ä–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏—Å—Ç–µ–º–æ–π SmartTransit.
====================================================================
`;
        }

        // ================ –§–£–ù–ö–¶–ò–ò –†–ê–ë–û–¢–´ –° –û–¢–ß–ï–¢–ê–ú–ò ================
        function viewReport(reportId) {
            const report = reportStorage.getReport(reportId);
            if (!report) {
                showNotification('–û—Ç—á–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }
            
            currentReportId = reportId;
            document.getElementById('reportContent').textContent = report.content || '–ù–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ';
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            const downloadBtn = document.getElementById('downloadReportBtn');
            downloadBtn.onclick = () => downloadReport(reportId);
            
            openModal('reportModal');
        }

        function downloadReport(reportId) {
            const report = reportStorage.getReport(reportId);
            if (!report) {
                showNotification('–û—Ç—á–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }
            
            const filename = `${report.name.replace(/\s+/g, '_')}_${new Date(report.createdAt).toISOString().split('T')[0]}.txt`;
            downloadFile(report.content || '–ù–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ', filename, 'text/plain');
            showNotification(`–û—Ç—á–µ—Ç "${report.name}" —Å–∫–∞—á–∞–Ω`, 'success');
        }

        function deleteReport(reportId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç—á–µ—Ç?')) {
                reportStorage.deleteReport(reportId);
                showNotification('–û—Ç—á–µ—Ç —É–¥–∞–ª–µ–Ω', 'success');
                loadReportsHistory();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ
                if (document.getElementById('reports-count')) {
                    document.getElementById('reports-count').textContent = reportStorage.getStats().total;
                }
            }
        }

        function refreshReports() {
            loadReportsHistory();
            showNotification('–°–ø–∏—Å–æ–∫ –æ—Ç—á–µ—Ç–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
        }

        // –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –≤ –≤–∞—à–µ–º script.js
async function exportData(format) {
    try {
        showNotification(`–ù–∞—á–∏–Ω–∞–µ–º —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ ${format.toUpperCase()}...`, 'info');
        
        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
        const exportData = await collectExportData();
        
        let content, filename, mimeType;
        
        switch(format.toLowerCase()) {
            case 'csv':
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º BOM –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–∏ UTF-8 –≤ Excel
                content = '\ufeff' + convertToCSV(exportData);
                filename = `export_${new Date().toISOString().split('T')[0]}.csv`;
                mimeType = 'text/csv;charset=utf-8;';
                break;
            case 'excel':
                content = '\ufeff' + convertToCSV(exportData);
                filename = `export_${new Date().toISOString().split('T')[0]}.xls`;
                mimeType = 'application/vnd.ms-excel;charset=utf-8';
                break;
            case 'json':
                content = JSON.stringify(exportData, null, 2);
                filename = `export_${new Date().toISOString().split('T')[0]}.json`;
                mimeType = 'application/json;charset=utf-8';
                break;
            default:
                throw new Error(`–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç: ${format}`);
        }
        
        downloadFile(content, filename, mimeType);
        showNotification(`–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ ${format.toUpperCase()}`, 'success');
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
        showNotification(`–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${error.message}`, 'error');
    }
}

// –î–æ–±–∞–≤—å—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è CSV
function convertToCSV(data) {
    let csv = '';
    
    // –≠–∫—Å–ø–æ—Ä—Ç –∞–≤—Ç–æ–±—É—Å–æ–≤
    csv += '–ê–í–¢–û–ë–£–°–´\n';
    csv += 'ID,–ú–æ–¥–µ–ª—å,–ú–∞—Ä—à—Ä—É—Ç,–°—Ç–∞—Ç—É—Å\n';
    data.buses.forEach(bus => {
        csv += `${bus.id},${bus.model},${bus.route},${bus.status}\n`;
    });
    
    csv += '\n–û–°–¢–ê–ù–û–í–ö–ò\n';
    csv += 'ID,–ù–∞–∑–≤–∞–Ω–∏–µ,–®–∏—Ä–æ—Ç–∞,–î–æ–ª–≥–æ—Ç–∞\n';
    data.stops.forEach(stop => {
        // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –∑–∞–ø—è—Ç—ã–µ –≤ –Ω–∞–∑–≤–∞–Ω–∏—è—Ö
        const name = stop.name.includes(',') ? `"${stop.name}"` : stop.name;
        csv += `${stop.id},${name},${stop.lat},${stop.lon}\n`;
    });
    
    csv += '\n–ü–ê–°–°–ê–ñ–ò–†–û–ü–û–¢–û–ö\n';
    csv += 'ID,–í—Ä–µ–º—è,–ê–≤—Ç–æ–±—É—Å ID,–û—Å—Ç–∞–Ω–æ–≤–∫–∞ ID,–í–æ—à–µ–¥—à–∏–µ,–í—ã—à–µ–¥—à–∏–µ\n';
    data.passengers.forEach(p => {
        csv += `${p.id},${p.timestamp},${p.busId},${p.stopId},${p.entered},${p.exited}\n`;
    });
    
    return csv;
}

// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è Excel —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º —Ç–∞–±—É–ª—è—Ü–∏–∏
function convertToExcel(data) {
    let excel = '';
    
    // –≠–∫—Å–ø–æ—Ä—Ç –∞–≤—Ç–æ–±—É—Å–æ–≤
    excel += '–ê–í–¢–û–ë–£–°–´\n';
    excel += 'ID\t–ú–æ–¥–µ–ª—å\t–ú–∞—Ä—à—Ä—É—Ç\t–°—Ç–∞—Ç—É—Å\n';
    data.buses.forEach(bus => {
        excel += `${bus.id}\t${bus.model}\t${bus.route}\t${bus.status}\n`;
    });
    
    excel += '\n–û–°–¢–ê–ù–û–í–ö–ò\n';
    excel += 'ID\t–ù–∞–∑–≤–∞–Ω–∏–µ\t–®–∏—Ä–æ—Ç–∞\t–î–æ–ª–≥–æ—Ç–∞\n';
    data.stops.forEach(stop => {
        excel += `${stop.id}\t${stop.name}\t${stop.lat}\t${stop.lon}\n`;
    });
    
    excel += '\n–ü–ê–°–°–ê–ñ–ò–†–û–ü–û–¢–û–ö\n';
    excel += 'ID\t–í—Ä–µ–º—è\t–ê–≤—Ç–æ–±—É—Å ID\t–û—Å—Ç–∞–Ω–æ–≤–∫–∞ ID\t–í–æ—à–µ–¥—à–∏–µ\t–í—ã—à–µ–¥—à–∏–µ\n';
    data.passengers.forEach(p => {
        excel += `${p.id}\t${p.timestamp}\t${p.busId}\t${p.stopId}\t${p.entered}\t${p.exited}\n`;
    });
    
    return excel;
}

// –û–±–Ω–æ–≤–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é downloadFile
function downloadFile(content, filename, mimeType) {
    // –î–ª—è CSV/Excel –∏—Å–ø–æ–ª—å–∑—É–µ–º Blob —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF-8
    const blob = new Blob([content], { 
        type: mimeType 
    });
    
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = filename;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    URL.revokeObjectURL(url);
}

// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç - —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∫–∞–∫ Excel –Ω–∞–ø—Ä—è–º—É—é
function exportToExcel(data) {
    // –°–æ–∑–¥–∞–µ–º Excel-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π CSV —Å —Ç–∞–±—É–ª—è—Ü–∏–µ–π
    let excelContent = '';
    
    // –õ–∏—Å—Ç "–ê–≤—Ç–æ–±—É—Å—ã"
    excelContent += 'ID\t–ú–æ–¥–µ–ª—å\t–ú–∞—Ä—à—Ä—É—Ç\t–°—Ç–∞—Ç—É—Å\n';
    data.buses.forEach(bus => {
        excelContent += `${bus.id}\t${bus.model}\t${bus.route}\t${bus.status}\n`;
    });
    
    excelContent += '\n'; // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É –ª–∏—Å—Ç–∞–º–∏
    
    // –õ–∏—Å—Ç "–û—Å—Ç–∞–Ω–æ–≤–∫–∏"
    excelContent += 'ID\t–ù–∞–∑–≤–∞–Ω–∏–µ\t–®–∏—Ä–æ—Ç–∞\t–î–æ–ª–≥–æ—Ç–∞\n';
    data.stops.forEach(stop => {
        excelContent += `${stop.id}\t${stop.name}\t${stop.lat}\t${stop.lon}\n`;
    });
    
    excelContent += '\n';
    
    // –õ–∏—Å—Ç "–ü–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫"
    excelContent += 'ID\t–í—Ä–µ–º—è\t–ê–≤—Ç–æ–±—É—Å ID\t–û—Å—Ç–∞–Ω–æ–≤–∫–∞ ID\t–í–æ—à–µ–¥—à–∏–µ\t–í—ã—à–µ–¥—à–∏–µ\n';
    data.passengers.forEach(p => {
        excelContent += `${p.id}\t${p.timestamp}\t${p.busId}\t${p.stopId}\t${p.entered}\t${p.exited}\n`;
    });
    
    // –î–æ–±–∞–≤–ª—è–µ–º BOM –¥–ª—è UTF-8
    const bom = '\ufeff';
    const blob = new Blob([bom + excelContent], {
        type: 'application/vnd.ms-excel;charset=utf-8'
    });
    
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `export_${new Date().toISOString().split('T')[0]}.xls`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
}

// –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Excel
async function exportWithSheetJS() {
    // –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ SheetJS (xlsx)
    if (window.XLSX) {
        try {
            const data = await collectExportData();
            
            // –°–æ–∑–¥–∞–µ–º —Ä–∞–±–æ—á—É—é –∫–Ω–∏–≥—É
            const wb = XLSX.utils.book_new();
            
            // –õ–∏—Å—Ç "–ê–≤—Ç–æ–±—É—Å—ã"
            const busData = data.buses.map(bus => [
                bus.id,
                bus.model,
                bus.route,
                bus.status
            ]);
            const busSheet = XLSX.utils.aoa_to_sheet([
                ['ID', '–ú–æ–¥–µ–ª—å', '–ú–∞—Ä—à—Ä—É—Ç', '–°—Ç–∞—Ç—É—Å'],
                ...busData
            ]);
            XLSX.utils.book_append_sheet(wb, busSheet, '–ê–≤—Ç–æ–±—É—Å—ã');
            
            // –õ–∏—Å—Ç "–û—Å—Ç–∞–Ω–æ–≤–∫–∏"
            const stopData = data.stops.map(stop => [
                stop.id,
                stop.name,
                stop.lat,
                stop.lon
            ]);
            const stopSheet = XLSX.utils.aoa_to_sheet([
                ['ID', '–ù–∞–∑–≤–∞–Ω–∏–µ', '–®–∏—Ä–æ—Ç–∞', '–î–æ–ª–≥–æ—Ç–∞'],
                ...stopData
            ]);
            XLSX.utils.book_append_sheet(wb, stopSheet, '–û—Å—Ç–∞–Ω–æ–≤–∫–∏');
            
            // –õ–∏—Å—Ç "–ü–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫"
            const passengerData = data.passengers.map(p => [
                p.id,
                p.timestamp,
                p.busId,
                p.stopId,
                p.entered,
                p.exited
            ]);
            const passengerSheet = XLSX.utils.aoa_to_sheet([
                ['ID', '–í—Ä–µ–º—è', '–ê–≤—Ç–æ–±—É—Å ID', '–û—Å—Ç–∞–Ω–æ–≤–∫–∞ ID', '–í–æ—à–µ–¥—à–∏–µ', '–í—ã—à–µ–¥—à–∏–µ'],
                ...passengerData
            ]);
            XLSX.utils.book_append_sheet(wb, passengerSheet, '–ü–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫');
            
            // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
            XLSX.writeFile(wb, `export_${new Date().toISOString().split('T')[0]}.xlsx`);
            showNotification('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ Excel', 'success');
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ —á–µ—Ä–µ–∑ SheetJS:', error);
            showNotification('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Excel', 'error');
        }
    } else {
        // Fallback –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π CSV
        exportData('csv');
    }
}

        async function collectExportData() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥—É—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ API
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            return {
                buses: [
                    { id: 1, model: '–ü–ê–ó-3205', route: '7A', status: 'active' },
                    { id: 2, model: '–õ–∏–ê–ó-5292', route: '12B', status: 'active' },
                    { id: 3, model: '–ú–ê–ó-103', route: '25C', status: 'maintenance' }
                ],
                stops: [
                    { id: 1, name: '–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å', lat: 55.7558, lon: 37.6173 },
                    { id: 2, name: '–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π –≤–æ–∫–∑–∞–ª', lat: 55.7556, lon: 37.6563 },
                    { id: 3, name: '–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç', lat: 55.7538, lon: 37.6198 }
                ],
                passengers: [
                    { id: 1, timestamp: '2024-01-15T08:30:00', busId: 1, stopId: 1, entered: 15, exited: 8 },
                    { id: 2, timestamp: '2024-01-15T09:15:00', busId: 2, stopId: 2, entered: 12, exited: 5 },
                    { id: 3, timestamp: '2024-01-15T10:00:00', busId: 1, stopId: 3, entered: 8, exited: 10 }
                ]
            };
        }

        function convertToCSV(data) {
            let csv = '';
            
            // –≠–∫—Å–ø–æ—Ä—Ç –∞–≤—Ç–æ–±—É—Å–æ–≤
            csv += '–ê–í–¢–û–ë–£–°–´\n';
            csv += 'ID,–ú–æ–¥–µ–ª—å,–ú–∞—Ä—à—Ä—É—Ç,–°—Ç–∞—Ç—É—Å\n';
            data.buses.forEach(bus => {
                csv += `${bus.id},${bus.model},${bus.route},${bus.status}\n`;
            });
            
            csv += '\n–û–°–¢–ê–ù–û–í–ö–ò\n';
            csv += 'ID,–ù–∞–∑–≤–∞–Ω–∏–µ,–®–∏—Ä–æ—Ç–∞,–î–æ–ª–≥–æ—Ç–∞\n';
            data.stops.forEach(stop => {
                csv += `${stop.id},${stop.name},${stop.lat},${stop.lon}\n`;
            });
            
            csv += '\n–ü–ê–°–°–ê–ñ–ò–†–û–ü–û–¢–û–ö\n';
            csv += 'ID,–í—Ä–µ–º—è,–ê–≤—Ç–æ–±—É—Å ID,–û—Å—Ç–∞–Ω–æ–≤–∫–∞ ID,–í–æ—à–µ–¥—à–∏–µ,–í—ã—à–µ–¥—à–∏–µ\n';
            data.passengers.forEach(p => {
                csv += `${p.id},${p.timestamp},${p.busId},${p.stopId},${p.entered},${p.exited}\n`;
            });
            
            return csv;
        }

        // ================ –î–†–£–ì–ò–ï –°–ï–ö–¶–ò–ò (–£–ü–†–û–©–ï–ù–ù–´–ï) ================
        async function loadBuses() {
            const html = `
                <div class="table-container">
                    <div class="table-header">
                        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–±—É—Å–∞–º–∏</h3>
                        <button class="btn btn-primary" onclick="showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info')">
                            <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–±—É—Å
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ú–æ–¥–µ–ª—å</th>
                                    <th>–ú–∞—Ä—à—Ä—É—Ç</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="4" class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = html;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            setTimeout(() => {
                const tbody = document.querySelector('tbody');
                tbody.innerHTML = `
                    <tr>
                        <td>1</td>
                        <td>–ü–ê–ó-3205</td>
                        <td>7A</td>
                        <td><span class="status-badge success">–ê–∫—Ç–∏–≤–µ–Ω</span></td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>–õ–∏–ê–ó-5292</td>
                        <td>12B</td>
                        <td><span class="status-badge success">–ê–∫—Ç–∏–≤–µ–Ω</span></td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>–ú–ê–ó-103</td>
                        <td>25C</td>
                        <td><span class="status-badge warning">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ</span></td>
                    </tr>
                `;
            }, 500);
        }

        async function loadStops() {
            const html = `
                <div class="table-container">
                    <div class="table-header">
                        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏</h3>
                        <button class="btn btn-primary" onclick="showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info')">
                            <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫—É
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                    <th>–®–∏—Ä–æ—Ç–∞</th>
                                    <th>–î–æ–ª–≥–æ—Ç–∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="4" class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = html;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            setTimeout(() => {
                const tbody = document.querySelector('tbody');
                tbody.innerHTML = `
                    <tr>
                        <td>1</td>
                        <td>–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å</td>
                        <td>55.7558</td>
                        <td>37.6173</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π –≤–æ–∫–∑–∞–ª</td>
                        <td>55.7556</td>
                        <td>37.6563</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç</td>
                        <td>55.7538</td>
                        <td>37.6198</td>
                    </tr>
                `;
            }, 500);
        }

        async function loadPassengers() {
            const html = `
                <div class="table-container">
                    <div class="table-header">
                        <h3>–£—á–µ—Ç –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫–∞</h3>
                        <button class="btn btn-primary" onclick="showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info')">
                            <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–í—Ä–µ–º—è</th>
                                    <th>–ê–≤—Ç–æ–±—É—Å</th>
                                    <th>–û—Å—Ç–∞–Ω–æ–≤–∫–∞</th>
                                    <th>–í–æ—à–µ–¥—à–∏–µ</th>
                                    <th>–í—ã—à–µ–¥—à–∏–µ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td colspan="6" class="text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            document.getElementById('contentArea').innerHTML = html;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            setTimeout(() => {
                const tbody = document.querySelector('tbody');
                tbody.innerHTML = `
                    <tr>
                        <td>1</td>
                        <td>2024-01-15 08:30</td>
                        <td>–ê–≤—Ç–æ–±—É—Å 1 (7A)</td>
                        <td>–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å</td>
                        <td>15</td>
                        <td>8</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>2024-01-15 09:15</td>
                        <td>–ê–≤—Ç–æ–±—É—Å 2 (12B)</td>
                        <td>–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π –≤–æ–∫–∑–∞–ª</td>
                        <td>12</td>
                        <td>5</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>2024-01-15 10:00</td>
                        <td>–ê–≤—Ç–æ–±—É—Å 1 (7A)</td>
                        <td>–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç</td>
                        <td>8</td>
                        <td>10</td>
                    </tr>
                `;
            }, 500);
        }

        // ================ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ================
        function logout() {
            showNotification('–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã...', 'info');
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        document.addEventListener('DOMContentLoaded', function() {
            // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.dataset.section;
                    loadSection(section);
                });
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
            if (reportStorage.getReports().length === 0) {
                addSampleReports();
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é —Å–µ–∫—Ü–∏—é
            loadSection('dashboard');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(() => {
                if (currentSection === 'dashboard') {
                    updateDashboardStats();
                }
            }, 30000);
        });

        function addSampleReports() {
            const sampleReports = [
                {
                    type: 'daily',
                    name: '–°—É—Ç–æ—á–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–ø–æ—Ç–æ–∫—É',
                    content: '–ü—Ä–∏–º–µ—Ä —Å—É—Ç–æ—á–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å.',
                    createdAt: new Date(Date.now() - 86400000).toISOString(),
                    status: 'completed',
                    size: '1.2 KB'
                },
                {
                    type: 'weekly',
                    name: '–ù–µ–¥–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞',
                    content: '–ê–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã –∑–∞ –ø—Ä–æ—à–ª—É—é –Ω–µ–¥–µ–ª—é —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.',
                    createdAt: new Date(Date.now() - 7 * 86400000).toISOString(),
                    status: 'completed',
                    size: '2.5 KB'
                },
                {
                    type: 'route',
                    name: '–û—Ç—á–µ—Ç –ø–æ –º–∞—Ä—à—Ä—É—Ç—É 7A',
                    content: '–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–∞ 7A –∑–∞ —è–Ω–≤–∞—Ä—å 2024.',
                    createdAt: new Date(Date.now() - 3 * 86400000).toISOString(),
                    status: 'completed',
                    size: '1.8 KB'
                }
            ];
            
            sampleReports.forEach(report => {
                reportStorage.addReport(report);
            });
        }
    </script>
</body>
</html>